<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phonics Whack-a-Mole</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4ECDC4;
            --dark: #2C3E50;
            --accent-voiced: #FF6B6B; /* Red for Buzz/Danger/Energy */
            --accent-unvoiced: #45B7D1; /* Blue for Quiet/Ghost/Cold */
            --ground: #95a5a6;
            --hole: #34495e;
            --selected: #f1c40f;
        }

        * {
            box-sizing: border-box;
            user-select: none;
            -webkit-user-select: none;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Fredoka', 'Noto Sans JP', sans-serif;
            background-color: #f7f9fc;
            color: var(--dark);
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        /* --- SCREENS --- */
        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: white;
            z-index: 10;
            transition: opacity 0.3s;
            padding: 20px;
            text-align: center;
        }

        .hidden {
            opacity: 0;
            pointer-events: none;
            z-index: -1;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: var(--dark);
        }

        h2 {
            font-size: 1.5rem;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        h3 {
            font-size: 1.2rem;
            color: var(--dark);
            margin: 15px 0 10px 0;
        }

        /* --- BUTTONS --- */
        .btn {
            padding: 15px 40px;
            font-size: 1.5rem;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            margin: 10px;
            transition: transform 0.1s, box-shadow 0.1s;
            font-family: 'Fredoka', sans-serif;
            color: white;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .btn:active {
            transform: scale(0.95);
            box-shadow: 0 2px 3px rgba(0,0,0,0.1);
        }

        .btn-voiced { background-color: var(--accent-voiced); }
        .btn-unvoiced { background-color: var(--accent-unvoiced); }
        .btn-restart { background-color: var(--primary); }
        
        /* Secondary Button (Gray) */
        .btn-secondary { 
            background-color: #95a5a6; 
            font-size: 1.2rem; /* Slightly smaller than primary */
            padding: 12px 30px;
        }

        /* Speed Selection Buttons */
        .speed-options {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .btn-speed {
            padding: 10px 20px;
            font-size: 1.1rem;
            border: 2px solid #bdc3c7;
            background-color: white;
            color: #7f8c8d;
            border-radius: 15px;
            cursor: pointer;
            font-family: 'Fredoka', sans-serif;
            font-weight: bold;
            transition: all 0.2s;
        }

        .btn-speed.selected {
            background-color: var(--selected);
            color: white;
            border-color: var(--selected);
            transform: scale(1.1);
            box-shadow: 0 3px 5px rgba(0,0,0,0.1);
        }

        /* --- GAME HUD --- */
        .hud {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255,255,255,0.9);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 5;
        }

        .score-board { font-size: 1.5rem; font-weight: bold; }
        .timer { font-size: 1.5rem; font-weight: bold; color: var(--dark); }
        .target-indicator {
            font-size: 1.2rem;
            padding: 5px 15px;
            border-radius: 20px;
            color: white;
            font-weight: bold;
        }

        .speed-indicator {
            font-size: 1.2rem;
            font-weight: bold;
            color: #7f8c8d;
            background: #ecf0f1;
            padding: 5px 15px;
            border-radius: 20px;
        }

        /* --- GAME GRID --- */
        .game-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            width: 95%;
            max-width: 600px;
            aspect-ratio: 1 / 1;
            margin-top: 60px; /* Space for HUD */
        }

        .hole {
            background-color: var(--ground);
            border-radius: 50%;
            position: relative;
            overflow: hidden;
            border-bottom: 8px solid rgba(0,0,0,0.1);
            cursor: pointer;
            box-shadow: inset 0 10px 20px rgba(0,0,0,0.2);
        }

        /* --- THE MOLE --- */
        .mole {
            width: 80%;
            height: 90%; /* Taller to fit text */
            background-color: #ecf0f1;
            position: absolute;
            bottom: -100%; /* Start hidden */
            left: 10%;
            border-radius: 30% 30% 10% 10%;
            transition: bottom 0.1s ease-out;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            border: 3px solid #bdc3c7;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .mole.up {
            bottom: 0;
        }

        .mole-text {
            font-size: 1.4rem;
            font-weight: bold;
            color: #2c3e50;
            margin-top: 10px;
            line-height: 1.2;
            pointer-events: none; /* Allow clicking through text */
        }
        
        /* Highlight the ending sound */
        .highlight {
            color: #e74c3c;
            text-decoration: underline;
        }

        /* Mole Face */
        .mole-face {
            width: 100%;
            height: 30px;
            position: absolute;
            top: 10px;
            display: flex;
            justify-content: center;
            gap: 10px;
            pointer-events: none;
        }
        .eye {
            width: 8px;
            height: 8px;
            background: #333;
            border-radius: 50%;
        }
        .nose {
            width: 12px;
            height: 8px;
            background: #e67e22;
            border-radius: 40%;
            position: absolute;
            top: 12px;
        }

        /* --- FEEDBACK ANIMATIONS --- */
        .feedback {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3rem;
            font-weight: bold;
            pointer-events: none;
            animation: popFade 0.8s forwards;
            z-index: 20;
            text-shadow: 2px 2px 0 #fff;
        }

        @keyframes popFade {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
            20% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
            100% { transform: translate(-50%, -100%) scale(1); opacity: 0; }
        }

        /* --- RESPONSIVE --- */
        @media (max-width: 600px) {
            .game-container { gap: 10px; }
            .mole-text { font-size: 1rem; }
            h1 { font-size: 1.8rem; }
            .btn { padding: 10px 20px; font-size: 1.2rem; }
            
            /* Compact HUD for mobile */
            .hud { padding: 10px 5px; }
            .score-board, .timer { font-size: 1rem; }
            .target-indicator, .speed-indicator { font-size: 0.8rem; padding: 4px 8px; }
        }

        .explanation {
            font-size: 0.9rem;
            color: #7f8c8d;
            margin-top: 20px;
            max-width: 80%;
            line-height: 1.5;
        }
    </style>
</head>
<body>

    <!-- START SCREEN -->
    <div id="start-screen" class="screen">
        <h1>üîä Phonics Mole</h1>
        
        <!-- Speed Selection -->
        <div class="setting-group">
            <h3>Mole Time (Speed):</h3>
            <div class="speed-options">
                <button class="btn-speed" onclick="setSpeed(2000, this)">2 Sec</button>
                <button class="btn-speed selected" onclick="setSpeed(3000, this)">3 Sec</button>
                <button class="btn-speed" onclick="setSpeed(4000, this)">4 Sec</button>
                <button class="btn-speed" onclick="setSpeed(5000, this)">5 Sec</button>
            </div>
        </div>

        <h2>Choose your target!</h2>
        
        <div style="display: flex; flex-direction: column; gap: 15px;">
            <button class="btn btn-voiced" onclick="startGame('voiced')">
                ‚ö° Catch VOICED<br><small>(Vibration / Buzz)</small>
            </button>
            <button class="btn btn-unvoiced" onclick="startGame('unvoiced')">
                üëª Catch UNVOICED<br><small>(No Sound / Whisper)</small>
            </button>
        </div>

        <div class="explanation">
            <p><strong>How to play:</strong><br>Only hit the words that match your target.<br>Watch out for tricky endings like "S", "ED" and "TH"!</p>
        </div>
    </div>

    <!-- GAME HUD -->
    <div id="hud" class="hud hidden">
        <div class="score-board">Score: <span id="score">0</span></div>
        <div id="target-display" class="target-indicator">Target: VOICED</div>
        <div id="speed-display" class="speed-indicator">Speed: 3s</div>
        <div class="timer">‚è±Ô∏è <span id="time-left">30</span></div>
    </div>

    <!-- GAME GRID -->
    <div id="game-container" class="game-container hidden">
        <div class="hole" onclick="bonk(0)"><div class="mole" id="mole-0"><div class="mole-face"><div class="eye"></div><div class="eye"></div><div class="nose"></div></div><div class="mole-text">Word</div></div></div>
        <div class="hole" onclick="bonk(1)"><div class="mole" id="mole-1"><div class="mole-face"><div class="eye"></div><div class="eye"></div><div class="nose"></div></div><div class="mole-text">Word</div></div></div>
        <div class="hole" onclick="bonk(2)"><div class="mole" id="mole-2"><div class="mole-face"><div class="eye"></div><div class="eye"></div><div class="nose"></div></div><div class="mole-text">Word</div></div></div>
        <div class="hole" onclick="bonk(3)"><div class="mole" id="mole-3"><div class="mole-face"><div class="eye"></div><div class="eye"></div><div class="nose"></div></div><div class="mole-text">Word</div></div></div>
        <div class="hole" onclick="bonk(4)"><div class="mole" id="mole-4"><div class="mole-face"><div class="eye"></div><div class="eye"></div><div class="nose"></div></div><div class="mole-text">Word</div></div></div>
        <div class="hole" onclick="bonk(5)"><div class="mole" id="mole-5"><div class="mole-face"><div class="eye"></div><div class="eye"></div><div class="nose"></div></div><div class="mole-text">Word</div></div></div>
        <div class="hole" onclick="bonk(6)"><div class="mole" id="mole-6"><div class="mole-face"><div class="eye"></div><div class="eye"></div><div class="nose"></div></div><div class="mole-text">Word</div></div></div>
        <div class="hole" onclick="bonk(7)"><div class="mole" id="mole-7"><div class="mole-face"><div class="eye"></div><div class="eye"></div><div class="nose"></div></div><div class="mole-text">Word</div></div></div>
        <div class="hole" onclick="bonk(8)"><div class="mole" id="mole-8"><div class="mole-face"><div class="eye"></div><div class="eye"></div><div class="nose"></div></div><div class="mole-text">Word</div></div></div>
    </div>

    <!-- GAME OVER SCREEN -->
    <div id="end-screen" class="screen hidden">
        <h1>Time's Up!</h1>
        <h2>Final Score: <span id="final-score">0</span></h2>
        <p id="feedback-msg" style="margin-bottom: 20px; font-size: 1.2rem;">Good job!</p>
        
        <!-- Navigation Options -->
        <div style="display: flex; flex-direction: column; gap: 10px;">
            <button class="btn btn-restart" onclick="startGame(currentTarget)">Play Again</button>
            <button class="btn btn-secondary" onclick="showStartScreen()">Back to Menu</button>
        </div>
    </div>

    <script>
        // --- GAME DATA ---
        const masterWordList = [
            // --- PLURALS (S vs Z) ---
            // Voiced (Z sound)
            { text: "Dog<span class='highlight'>s</span>", type: "voiced" },
            { text: "Pen<span class='highlight'>s</span>", type: "voiced" },
            { text: "Bag<span class='highlight'>s</span>", type: "voiced" },
            { text: "Game<span class='highlight'>s</span>", type: "voiced" },
            { text: "Boy<span class='highlight'>s</span>", type: "voiced" },
            { text: "Car<span class='highlight'>s</span>", type: "voiced" },
            { text: "Bed<span class='highlight'>s</span>", type: "voiced" },
            { text: "Hand<span class='highlight'>s</span>", type: "voiced" },
            { text: "Apple<span class='highlight'>s</span>", type: "voiced" },
            { text: "Star<span class='highlight'>s</span>", type: "voiced" },
            { text: "Eye<span class='highlight'>s</span>", type: "voiced" },
            { text: "Friend<span class='highlight'>s</span>", type: "voiced" },
            
            // Unvoiced (S sound)
            { text: "Cat<span class='highlight'>s</span>", type: "unvoiced" },
            { text: "Book<span class='highlight'>s</span>", type: "unvoiced" },
            { text: "Cup<span class='highlight'>s</span>", type: "unvoiced" },
            { text: "Map<span class='highlight'>s</span>", type: "unvoiced" },
            { text: "Desk<span class='highlight'>s</span>", type: "unvoiced" },
            { text: "Student<span class='highlight'>s</span>", type: "unvoiced" },
            { text: "Hat<span class='highlight'>s</span>", type: "unvoiced" },
            { text: "Bat<span class='highlight'>s</span>", type: "unvoiced" },
            { text: "Sock<span class='highlight'>s</span>", type: "unvoiced" },
            { text: "Shirt<span class='highlight'>s</span>", type: "unvoiced" },
            { text: "Rabbit<span class='highlight'>s</span>", type: "unvoiced" },

            // --- PAST TENSE (ED) ---
            // Voiced (D sound)
            { text: "Play<span class='highlight'>ed</span>", type: "voiced" },
            { text: "Clean<span class='highlight'>ed</span>", type: "voiced" },
            { text: "Love<span class='highlight'>d</span>", type: "voiced" },
            { text: "Use<span class='highlight'>d</span>", type: "voiced" },
            { text: "Live<span class='highlight'>d</span>", type: "voiced" },
            { text: "Open<span class='highlight'>ed</span>", type: "voiced" },
            { text: "Call<span class='highlight'>ed</span>", type: "voiced" },
            { text: "Listen<span class='highlight'>ed</span>", type: "voiced" },
            { text: "Stay<span class='highlight'>ed</span>", type: "voiced" },
            { text: "Rain<span class='highlight'>ed</span>", type: "voiced" },

            // Unvoiced (T sound)
            { text: "Watch<span class='highlight'>ed</span>", type: "unvoiced" },
            { text: "Wash<span class='highlight'>ed</span>", type: "unvoiced" },
            { text: "Cook<span class='highlight'>ed</span>", type: "unvoiced" },
            { text: "Stop<span class='highlight'>ped</span>", type: "unvoiced" },
            { text: "Look<span class='highlight'>ed</span>", type: "unvoiced" },
            { text: "Walk<span class='highlight'>ed</span>", type: "unvoiced" },
            { text: "Help<span class='highlight'>ed</span>", type: "unvoiced" },
            { text: "Ask<span class='highlight'>ed</span>", type: "unvoiced" },
            { text: "Like<span class='highlight'>d</span>", type: "unvoiced" },
            { text: "Jump<span class='highlight'>ed</span>", type: "unvoiced" },

            // --- TH SOUNDS ---
            // Voiced (Vibration)
            { text: "<span class='highlight'>Th</span>is", type: "voiced" },
            { text: "<span class='highlight'>Th</span>ey", type: "voiced" },
            { text: "<span class='highlight'>Th</span>em", type: "voiced" },
            { text: "Fa<span class='highlight'>th</span>er", type: "voiced" },
            { text: "Mo<span class='highlight'>th</span>er", type: "voiced" },
            { text: "Bro<span class='highlight'>th</span>er", type: "voiced" },
            { text: "Fea<span class='highlight'>th</span>er", type: "voiced" },
            { text: "Wea<span class='highlight'>th</span>er", type: "voiced" },
            { text: "Smoo<span class='highlight'>th</span>", type: "voiced" },
            { text: "Brea<span class='highlight'>the</span>", type: "voiced" },

            // Unvoiced (No Vibration)
            { text: "<span class='highlight'>Th</span>ank", type: "unvoiced" },
            { text: "<span class='highlight'>Th</span>ree", type: "unvoiced" },
            { text: "<span class='highlight'>Th</span>ick", type: "unvoiced" },
            { text: "<span class='highlight'>Th</span>ink", type: "unvoiced" },
            { text: "Ma<span class='highlight'>th</span>", type: "unvoiced" },
            { text: "Mou<span class='highlight'>th</span>", type: "unvoiced" },
            { text: "Ba<span class='highlight'>th</span>", type: "unvoiced" },
            { text: "Too<span class='highlight'>th</span>", type: "unvoiced" },
            { text: "Nor<span class='highlight'>th</span>", type: "unvoiced" },
            { text: "Ear<span class='highlight'>th</span>", type: "unvoiced" }
        ];

        // --- VARIABLES ---
        let score = 0;
        let lastHole;
        let timeUp = false;
        let scoreBoard = document.querySelector('#score');
        let moles = document.querySelectorAll('.mole');
        let currentTarget = 'voiced'; // 'voiced' or 'unvoiced'
        let gameTimer;
        let moleTimer;
        let selectedSpeed = 3000; // Default 3 seconds
        let availableWords = []; // Pool of words to draw from

        // --- INITIALIZATION ---
        function showStartScreen() {
            document.getElementById('end-screen').classList.add('hidden');
            document.getElementById('hud').classList.add('hidden');
            document.getElementById('game-container').classList.add('hidden');
            document.getElementById('start-screen').classList.remove('hidden');
        }

        // Function to handle speed selection
        function setSpeed(ms, btn) {
            selectedSpeed = ms;
            
            // Update UI to show selected button
            document.querySelectorAll('.btn-speed').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
        }

        function startGame(target) {
            currentTarget = target;
            scoreBoard.textContent = 0;
            score = 0;
            timeUp = false;
            
            // Reset the word pool by creating a fresh copy of the master list
            availableWords = [...masterWordList];
            
            // Setup UI based on target
            const indicator = document.getElementById('target-display');
            if(target === 'voiced') {
                indicator.textContent = "Target: ‚ö° VOICED";
                indicator.style.backgroundColor = "var(--accent-voiced)";
            } else {
                indicator.textContent = "Target: üëª UNVOICED";
                indicator.style.backgroundColor = "var(--accent-unvoiced)";
            }

            // Update Speed Display
            document.getElementById('speed-display').textContent = `Speed: ${selectedSpeed / 1000}s`;

            // Manage Screen Visibility
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('end-screen').classList.add('hidden'); // Ensure end screen is hidden on retry
            document.getElementById('hud').classList.remove('hidden');
            document.getElementById('game-container').classList.remove('hidden');

            // Start Timer
            let timeLeft = 30;
            document.getElementById('time-left').textContent = timeLeft;
            gameTimer = setInterval(() => {
                timeLeft--;
                document.getElementById('time-left').textContent = timeLeft;
                if(timeLeft <= 0) {
                    endGame();
                }
            }, 1000);

            peep();
        }

        // --- GAME LOGIC ---
        function randomHole(holes) {
            const idx = Math.floor(Math.random() * holes.length);
            const hole = holes[idx];
            if (hole === lastHole) return randomHole(holes);
            lastHole = hole;
            return idx;
        }

        function peep() {
            // Use selected speed (fixed time)
            const time = selectedSpeed; 
            
            // Get a random hole (ensuring it's not the same as the last one)
            const holeIndex = randomHole(moles);
            const mole = document.getElementById(`mole-${holeIndex}`);
            
            // Logic to pick a unique word
            if (availableWords.length === 0) {
                // If we run out of words (unlikely in 30s), refill the pool
                availableWords = [...masterWordList];
            }
            
            // Pick a random index from the available words
            const randomIndex = Math.floor(Math.random() * availableWords.length);
            const wordObj = availableWords[randomIndex];
            
            // Remove the chosen word from the pool so it doesn't repeat this round
            availableWords.splice(randomIndex, 1);
            
            // Store data on the mole element
            mole.dataset.type = wordObj.type;
            mole.querySelector('.mole-text').innerHTML = wordObj.text;

            // Show mole
            mole.classList.add('up');

            // Hide mole after 'time'
            moleTimer = setTimeout(() => {
                mole.classList.remove('up');
                if (!timeUp) peep();
            }, time);
        }

        function bonk(index) {
            const mole = document.getElementById(`mole-${index}`);
            if(!mole.classList.contains('up')) return;

            mole.classList.remove('up');
            
            const moleType = mole.dataset.type;
            const isCorrect = (moleType === currentTarget);
            
            createFeedback(index, isCorrect);

            if(isCorrect) {
                score += 10;
            } else {
                score -= 5;
            }
            scoreBoard.textContent = score;
        }

        function createFeedback(holeIndex, isCorrect) {
            const hole = document.querySelectorAll('.hole')[holeIndex];
            const feedback = document.createElement('div');
            feedback.classList.add('feedback');
            
            if(isCorrect) {
                feedback.textContent = (currentTarget === 'voiced') ? "‚ö° Buzz!" : "üëª Quiet!";
                feedback.style.color = (currentTarget === 'voiced') ? "#c0392b" : "#2980b9";
            } else {
                feedback.textContent = "‚ùå";
                feedback.style.color = "#7f8c8d";
            }
            
            hole.appendChild(feedback);
            setTimeout(() => feedback.remove(), 800);
        }

        function endGame() {
            timeUp = true;
            clearInterval(gameTimer);
            clearTimeout(moleTimer);
            
            // Hide all moles immediately
            moles.forEach(mole => mole.classList.remove('up'));

            setTimeout(() => {
                document.getElementById('hud').classList.add('hidden');
                document.getElementById('game-container').classList.add('hidden');
                document.getElementById('end-screen').classList.remove('hidden');
                document.getElementById('final-score').textContent = score;
                
                const msg = document.getElementById('feedback-msg');
                if(score > 100) msg.textContent = "Amazing! Native Speaker Level! üèÜ";
                else if(score > 50) msg.textContent = "Great job! Keep practicing! üëç";
                else msg.textContent = "Nice try! Don't give up! üí™";
            }, 500);
        }

    </script>
</body>
</html>
